<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ご家族さま向けお知らせ・生成モック（Gemini API v1対応）</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body{font-family:'Noto Sans JP',sans-serif;margin:0;padding:24px;background:#fff;color:#111}
h1{font-size:22px;margin-bottom:4px}
.sub{font-size:13px;color:#666;margin-bottom:16px}
.wrap{max-width:1080px;margin:auto;display:grid;gap:20px}
@media(min-width:900px){.wrap{grid-template-columns:1fr 1fr}}
.card{border:1px solid #ddd;border-radius:10px;padding:16px;background:#fafafa}
textarea{width:100%;min-height:140px;border:1px solid #ccc;border-radius:8px;padding:10px}
button{padding:8px 14px;border-radius:8px;border:1px solid #ccc;cursor:pointer}
.btn-primary{background:#1976d2;color:#fff;border-color:#1976d2}
.mail{border:1px solid #ddd;border-radius:8px}
.mail-top{background:#1976d2;color:#fff;padding:10px;border-radius:8px 8px 0 0}
.mail-body{padding:16px}
.small{font-size:12px;color:#555}
.genbox{border:1px dashed #aaa;border-radius:8px;padding:10px;min-height:100px;white-space:pre-wrap}
</style>
</head>
<body>
<h1>ご家族さま向けお知らせ・生成モック（Gemini API対応）</h1>
<p class="sub">Google Gemini API（v1）を使用。APIキーを組み込み済み。</p>

<div class="wrap">
  <section class="card">
    <h3>① 箇条書きを入力</h3>
    <textarea id="bullets" placeholder="10/12　お買い物イベント（しまむら）&#10;10/20　施設創立30周年&#10;朝晩冷え込み"></textarea>
    <div style="margin-top:10px">
      <button id="sample">サンプル</button>
      <button id="generate" class="btn-primary">生成AIでつくる</button>
    </div>
  </section>

  <section class="mail">
    <div class="mail-top">生成結果</div>
    <div class="mail-body">
      <div class="small">利用者ご家族様</div>
      <div class="small">こんにちは。<br>●●事業所の●●です。</div>
      <div class="genbox" id="out">（左に入力して「生成AIでつくる」を押すとここに文章が入ります）</div>
    </div>
  </section>
</div>

<script>
const API_KEY = "AIzaSyAmLXF9IQDUYo7fef33wNp_69yuncyMLUY";
const GEMINI_URL = "https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash-latest:generateContent";

async function callGemini(prompt){
  const res = await fetch(`${GEMINI_URL}?key=${API_KEY}`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      contents: [{role: "user", parts: [{text: prompt}]}]
    })
  });
  if(!res.ok){
    const t = await res.text();
    throw new Error("Gemini API error: " + res.status + " " + t);
  }
  const data = await res.json();
  return data?.candidates?.[0]?.content?.parts?.map(p => p.text).join('') || "(生成できませんでした)";
}

document.getElementById("sample").onclick = ()=>{
  document.getElementById("bullets").value = "10/12　お買い物イベント（しまむら）\n10/20　施設創立30周年\n朝晩冷え込み";
};

document.getElementById("generate").onclick = async ()=>{
  const bullets = document.getElementById("bullets").value.trim();
  const out = document.getElementById("out");
  if(!bullets){ out.textContent = "（箇条書きを入力してください）"; return; }
  out.textContent = "生成中...";
  const prompt = "あなたは介護職員として、ご家族向けに短いお知らせ文を日本語で作成します。\n以下の箇条書きを参考に、200文字以内で自然な文章を生成してください。\n" + bullets;
  try{
    const text = await callGemini(prompt);
    out.textContent = text;
  }catch(e){
    out.textContent = e.message;
  }
};
</script>
</body>
</html>
